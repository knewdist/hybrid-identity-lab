## 7. Kerberos PAC Refresh After Group Membership Change

### Scenario

User `ivan.it` was added to:

- `GG_Accounting` (Global Group)
- Nested into `DL_Accounting_RW` (Domain Local Group)
- `DL_Accounting_RW` granted NTFS permissions to `\\FS01\Accounting`

Permission model used:

User → GG_Accounting → DL_Accounting_RW → NTFS ACL

---

## Initial State (Before Ticket Refresh)

The user was already logged in when the group membership change occurred.

### Verify Group Membership

```powershell
whoami /groups | findstr Accounting

Result:
(no output)


Inspect Kerberos Tickets
klist

Primary TGT:

Server: krbtgt/CORP.LOCAL
Start Time: 19:03:30
Cache Flags: PRIMARY
Access Attempt
\\FS01\Accounting

Result:

Access Denied
Reason

TGT was issued before group membership change

PAC inside the TGT did not contain Accounting group SIDs

FS01 trusted the PAC contents, not a live Active Directory lookup

Kerberos Ticket Purge

Tickets were purged to force reauthentication:

klist purge

All cached tickets were deleted.

Verify New Ticket Issuance
klist

New TGT observed:

Start Time: 19:19:44

The new timestamp confirms the Domain Controller reissued a new TGT and regenerated the PAC.

Validate Updated Group Membership
whoami /groups | findstr Accounting

Output:

CORP\GG_Accounting
CORP\DL_Accounting_RW

This confirms:

PAC was regenerated

Updated group SIDs were embedded in the Kerberos ticket

Local authorization token reflects new membership

Access Attempt After Ticket Refresh
\\FS01\Accounting

Result:

Access Granted
Authorization Flow Confirmed

Client presents CIFS/FS01 service ticket

FS01 validates PAC signature using KRBTGT key

FS01 builds authorization token from PAC

NTFS ACL evaluates DL_Accounting_RW

Access is granted

### Key Identity Behavior Observed

-File servers do not query Active Directory in real time for group membership
Authorization decisions are based on the PAC embedded in the Kerberos ticket

-Group membership changes require a new TGT (logoff or ticket purge)
-Nested group model (AGDLP) functions correctly in authorization flow
-whoami /groups reflects the security token used for access decisions
-klist confirms Kerberos ticket lifecycle and timestamps
